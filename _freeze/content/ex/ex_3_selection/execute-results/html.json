{
  "hash": "ee4441ffcafaf2e6c5c185225396a51c",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Exercise - Selection\"\nsubtitle: \"Why to select one model or another?\"\npublished-title: \"Date\"\ndate: \"2024-10-15\"\nself-contained: true\nengine: knitr\n---\n\n::: {.cell}\n\n:::\n\n\n::: {.callout-important title=\"Instructions\"}\nThis page gives both instructions and some interactive snippets. You will have to run most of your code on `RStudio`, on your own computer.\n:::\n\nFirst, let's load useful packages. We need the `tidyverse` package but also to install the `wooldridge` package (it contains the dataset we are interested in).\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\n# install.packages(\"wooldridge\")\n\nlibrary(tidyverse)\nlibrary(wooldridge)\n```\n:::\n\n\n## Exploring the Data Set\n\n### The Data\n\nLoad the data by calling `wage1` (after loading the package using `library(wooldridge)`).\n\nPrint the dataset. It prints in a different format than what we are used to. It is stored in a dataframe and not the tibbles we are used to. Let's create a tibble version of this data set, using the function `as_tibble()`; run the following line of code:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nwage <- as_tibble(wage1)\n```\n:::\n\n\nWhat does each variable represent? (use the `help()` function). How many observations are there in this data set? <input class='webex-solveme nospaces' size='3' data-answer='[\"526\"]'/>.\n\n### \"Research\" Question\n\n::: {.callout-tip title=\"Objective\"}\nWe will study how to better explain/predict hourly wage, based on the set of covariates available in the data set\n:::\n\nWe want to build a model that accurately describes the variation in wage. Why can understanding how wage evolves with various covariates matter for economics research?\n\n### Summarising the Data\n\nBefore anything, let's quickly explore the data. To have an overview of the dataset, we can use the function `glimpse(wage)`.\n\nWhat type of variable does `profocc` seem to be? <select class='webex-select'><option value='blank'></option><option value=''>Continuous</option><option value='answer'>Binary</option></select> Confirm this by exploring the documentation for the data set (the `help`)\n\nThe `summary()` function can also provide interesting information on the dataset. Call this function. What is the median number of years of educations in the data set? <input class='webex-solveme nospaces' data-tol='0.1' size='2' data-answer='[\"12\"]'/>\n\nWhat is the proportion of married individuals in this data set? <input class='webex-solveme nospaces' data-tol='0.01' size='3' data-answer='[\"0.6\",\".6\"]'/>[^1]\n\n[^1]: This information is directly accessible through `summary(wage)`\n\n### Distribution of Wage\n\nWe want to study the variation in `wage`, before anything, let's plot its distribution as we did in [the previous exercise](ex_2_specification.qmd)!\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# plot distrib wage\n```\n:::\n\n\nDo you notice anything weird or erroneous? <!-- There is a negative value -->\n\n### Relationship between wage and education\n\nWe can then explore its correlation with education. Which `ggplot` function should we use? <input class='webex-solveme nospaces' size='10' data-answer='[\"geom_point\"]'/>\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# plot relationship between wage and education\n```\n:::\n\n\nWhat do we notice?\n\nIn addition, larger levels of education seem to be associated with <select class='webex-select'><option value='blank'></option><option value='answer'>larger</option><option value=''>smaller</option></select> hourly wages.\n\nWe may also be interested in disparities by gender. We can plot the same graph distinguishing by gender. To do so, add `color = female` within the `aes()` function: `aes(x = ..., y = ..., color = female)`.\n\n`ggplot` treats `female` as a continuous variable (an integer). Instead, this variable is binary. To transform it as categorical variable, we can use the `as_factor()` function: `aes(x = ..., y = ..., color = as_factor(female))`.\n\nFor a given level of education, the wage of female individuals seems to be <select class='webex-select'><option value='blank'></option><option value=''>larger</option><option value='answer'>lower</option><option value=''>identical</option></select> than the wage of non-female ones.\n\nDoes the relationship between wage and education seem different for female and non-female?\n\n### Relationship Between Wage and Other Variables\n\nGo on with this data exploration: look at the correlation between wage and experience, tenure and their squares. Can you see a clear relationship between the square of experience and wage? <select class='webex-select'><option value='blank'></option><option value=''>Yes</option><option value='answer'>No</option></select>\n\nDoes that mean that there is no statistical relationship between these two variables? <select class='webex-select'><option value='blank'></option><option value=''>Yes</option><option value='answer'>No</option></select>\n\nHow would you expect this relationship to be <select class='webex-select'><option value='blank'></option><option value=''>positive</option><option value=''>null</option><option value='answer'>negative</option></select> Why?\n\n::: callout-note\nYou can do a lot more data exploration using graphs but also tables. We will however now turn to modeling.\n:::\n\n## Quadratics\n\nLet's first explore the relationship between hourly wage, level of education, experience and experience squared. Regress wage on these variables, as we did last weeks.\n\n::: callout-tip\nThe variable `expersq` is already in the data set; you can call it directly. If you use `exper^2` in your regression, what happens? To remedy this, you need to tell `R` that you are actually creating a new variable, using the function `I(exper^2)`: `formula = ... ~ ... + I(exper^2)`.\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# regression\n```\n:::\n\n\nWhat is the point estimate for `educ`? <input class='webex-solveme nospaces' data-tol='0.01' size='4' data-answer='[\"0.59\",\".59\"]'/>. How would you interpret this coefficient?\n\n\n::: {.cell}\n\n:::\n\n\n<div class='webex-radiogroup' id='radio_TKAVZDAAFV'><label><input type=\"radio\" autocomplete=\"off\" name=\"radio_TKAVZDAAFV\" value=\"\"></input> <span>Comparing two individuals with the same level of experience, we expect one with one more year of education to earn on average 0.6% more per hour than the other</span></label><label><input type=\"radio\" autocomplete=\"off\" name=\"radio_TKAVZDAAFV\" value=\"\"></input> <span>Comparing two individuals, we expect one with one more year of education to earn on average $0.6 more per hour than the other</span></label><label><input type=\"radio\" autocomplete=\"off\" name=\"radio_TKAVZDAAFV\" value=\"answer\"></input> <span>Comparing two individuals with the same level of experience, we expect one with one more year of education to earn on average $0.6 more per hour than the other</span></label><label><input type=\"radio\" autocomplete=\"off\" name=\"radio_TKAVZDAAFV\" value=\"\"></input> <span>Comparing two individuals with the same level of experience, we expect one with one more year of education to earn on average 6% more per hour than the other</span></label><label><input type=\"radio\" autocomplete=\"off\" name=\"radio_TKAVZDAAFV\" value=\"\"></input> <span>None of the above</span></label></div>\n\n\nWhat is the point estimate for `exper`? <input class='webex-solveme nospaces' data-tol='0.01' size='4' data-answer='[\"0.26\",\".26\"]'/>. How would you interpret this coefficient?\n\n\n::: {.cell}\n\n:::\n\n\n<div class='webex-radiogroup' id='radio_AWLBKKUKAL'><label><input type=\"radio\" autocomplete=\"off\" name=\"radio_AWLBKKUKAL\" value=\"\"></input> <span>Comparing two individuals with the same level of education, we expect one with one more year of experience to earn on average 0.27% more per hour than the other</span></label><label><input type=\"radio\" autocomplete=\"off\" name=\"radio_AWLBKKUKAL\" value=\"\"></input> <span>Comparing two individuals with the same level of education, we expect one with one more year of experience to earn on average $0.27 more per hour than the other</span></label><label><input type=\"radio\" autocomplete=\"off\" name=\"radio_AWLBKKUKAL\" value=\"\"></input> <span>Comparing two individuals with the same level of education, we expect one with one more year of experience to earn on average 2.7% more per hour than the other</span></label><label><input type=\"radio\" autocomplete=\"off\" name=\"radio_AWLBKKUKAL\" value=\"answer\"></input> <span>None of the above</span></label></div>\n\n\nFor how many years of experience could you easily interpret this coefficient? <input class='webex-solveme nospaces' size='1' data-answer='[\"0\",\"1\"]'/>. The presence of which variable in the analysis can explain this difference? <select class='webex-select'><option value='blank'></option><option value=''>wage</option><option value=''>educ</option><option value=''>exper</option><option value='answer'>expersq</option></select>\n\nComparing two individuals with the same level of education, we expect one with 3 years of experience to earn on average <input class='webex-solveme nospaces' data-tol='0.01' size='4' data-answer='[\"0.25\",\".25\"]'/> more per hour than one with 2 years of experience. What is the general formula to compute this quantity?\n\n\n<div class='webex-solution'><button>Answer</button>\n $$\\frac{\\partial \\widehat{wage}}{\\partial exp} = \\hat{\\beta_2} + 2 \\hat{\\beta_3} exp $$ \n</div>\n\n\nHow do you interpret the sign of `expersq`?\n\n\n<div class='webex-solution'><button>Answer</button>\n There are decreasing marginal returns to experience. \n</div>\n\n\n## Indicators\n\nWe will now explore how the relationship between level of education and wage varies by marital status. If we add a `married` dummy, what is the coefficient for `educ`? <input class='webex-solveme nospaces' data-tol='0.01' size='8' data-answer='[\"0.583786\",\".583786\"]'/>\n\nHow do we interpret it?\n\n\n::: {.cell}\n\n:::\n\n\n<div class='webex-radiogroup' id='radio_SVEDYRVVFW'><label><input type=\"radio\" autocomplete=\"off\" name=\"radio_SVEDYRVVFW\" value=\"\"></input> <span>Comparing two individuals with the same level of education, we expect one with one more year of experience to earn on average $0.58 more per hour than the other</span></label><label><input type=\"radio\" autocomplete=\"off\" name=\"radio_SVEDYRVVFW\" value=\"\"></input> <span>Comparing two individuals with the same level of experience, we expect one with one more year of education to earn on average $0.58 more per hour than the other</span></label><label><input type=\"radio\" autocomplete=\"off\" name=\"radio_SVEDYRVVFW\" value=\"answer\"></input> <span>Comparing two individuals with the same level of experience and marital status, we expect one with one more year of education to earn on average $0.58 more per hour than the other</span></label></div>\n\n\nFor a given level of education, on average, we expect married individual to earn <input class='webex-solveme nospaces' data-tol='0.01' size='8' data-answer='[\"0.507491\",\".507491\"]'/> dollars more/less per hour than non married one.\n\nDoes the relationship between level of education and wage varies by marital status? <select class='webex-select'><option value='blank'></option><option value=''>Yes</option><option value='answer'>No</option></select>\n\nIf you plot the regression lines for both groups, they will be <input class='webex-solveme nospaces' size='8' data-answer='[\"parallel\"]'/>\n\n## Interactions\n\nTo make this relationship vary by marital status, we can interact the variable of interest, `educ`, with `married`. To interact two variables, we can use `:`: *eg* `y ~ x:z`.\n\nWhich variables do we need to include in the model?\n\n\n<div class='webex-solution'><button>Answer</button>\n `educ`, `married`, `educ:married`, `exper` and `expersq` \n</div>\n\n\n::: callout-tip\nTry only having `educ*married`, `exper` and `expersq` in your formula. What happens to your results? What does the `*` do?\n:::\n\nComparing two married individuals with the same level of experience, we expect one with one more year of education to earn on average <input class='webex-solveme nospaces' data-tol='0.01' size='8' data-answer='[\"0.633126\",\".633126\"]'/> more per hour than the other.\n\nComparing two non-married individuals with the same level of experience, we expect one with one more year of education to earn on average <input class='webex-solveme nospaces' data-tol='0.01' size='8' data-answer='[\"0.509667\",\".509667\"]'/> more per hour than the other.\n\nPlot the relationship between wage and education. Add a regression line. To do so, we need to use the <input class='webex-solveme nospaces' size='11' data-answer='[\"geom_smooth\"]'/> function.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#plot\n```\n:::\n\n\nLet's now plot separate lines for married vs non-married individuals. To do so, we need to add the `color = married` aesthetic (`aes(..., color = married)`).\n\n## Model selection\n\nLet's now dive into model selection.\n\n### $R^2$\n\nWhat is the $R^2$ of the regression of wage on the level of education, the level of experience and its square? <input class='webex-solveme nospaces' data-tol='0.01' size='6' data-answer='[\"0.2692\",\".2692\"]'/>[^2]\n\n[^2]: Run the regression and print its summary.\n\nWhat is the adjusted$-R^2$? <input class='webex-solveme nospaces' data-tol='0.01' size='5' data-answer='[\"0.265\",\".265\"]'/>. Is the difference with the $R^2$ large? Why so?\n\nHow would you interpret the $R^2$ (or the adjusted$-R^2$)?\n\n\n::: {.cell}\n\n:::\n\n\n<div class='webex-radiogroup' id='radio_URYPRKQTZA'><label><input type=\"radio\" autocomplete=\"off\" name=\"radio_URYPRKQTZA\" value=\"\"></input> <span>The model explains 0.27% of the variation in education</span></label><label><input type=\"radio\" autocomplete=\"off\" name=\"radio_URYPRKQTZA\" value=\"\"></input> <span>The model explains 27% of the variation in education</span></label><label><input type=\"radio\" autocomplete=\"off\" name=\"radio_URYPRKQTZA\" value=\"answer\"></input> <span>The model explains 27% of the variation in wage</span></label><label><input type=\"radio\" autocomplete=\"off\" name=\"radio_URYPRKQTZA\" value=\"\"></input> <span>The model explains 0.27% of the variation in wage</span></label></div>\n\n\nAdd `nonwhite`, `tenure`, `female`, `married`, `numdep` to the model. Does the this model explains a larger proportion of the variation in wage? <select class='webex-select'><option value='blank'></option><option value='answer'>Yes</option><option value=''>No</option></select>\n\nDoes the coefficient for `educ` vary? Why?\n\nIs the interpretation of this coefficient the same as before? <select class='webex-select'><option value='blank'></option><option value=''>Yes</option><option value='answer'>No</option></select>\n\n### Misspecification\n\nLet's get back to our simple model of wage on the level of education, the level of experience and its square. Does including `female` affect the coefficient for `educ`? <select class='webex-select'><option value='blank'></option><option value='answer'>Yes</option><option value=''>No</option></select> Why?\n\n\n::: {.cell}\n\n:::\n\n\n<div class='webex-radiogroup' id='radio_OUDLAWQXTP'><label><input type=\"radio\" autocomplete=\"off\" name=\"radio_OUDLAWQXTP\" value=\"\"></input> <span>This is only noise</span></label><label><input type=\"radio\" autocomplete=\"off\" name=\"radio_OUDLAWQXTP\" value=\"\"></input> <span>Female is correlated with education</span></label><label><input type=\"radio\" autocomplete=\"off\" name=\"radio_OUDLAWQXTP\" value=\"answer\"></input> <span>Female is correlated with both wage and education</span></label><label><input type=\"radio\" autocomplete=\"off\" name=\"radio_OUDLAWQXTP\" value=\"\"></input> <span>Female is correlated with wage</span></label></div>\n\n\nIn the first specification, `female` is an <input class='webex-solveme nospaces' size='16' data-answer='[\"omitted variable\"]'/>. What other variables in the data set could have similar effects? Should we include them in the model? <select class='webex-select'><option value='blank'></option><option value='answer'>Yes</option><option value=''>No</option></select>\n\nShould we include any variables in the model? <select class='webex-select'><option value='blank'></option><option value=''>Yes</option><option value='answer'>No</option></select> Why? \n\n\n::: {.cell}\n\n:::\n\n\n<div class='webex-radiogroup' id='radio_KNHDEIMMFQ'><label><input type=\"radio\" autocomplete=\"off\" name=\"radio_KNHDEIMMFQ\" value=\"\"></input> <span>Irrelevant variables will create a bias</span></label><label><input type=\"radio\" autocomplete=\"off\" name=\"radio_KNHDEIMMFQ\" value=\"answer\"></input> <span>Irrelevant variables will increase the variance of the estimator</span></label><label><input type=\"radio\" autocomplete=\"off\" name=\"radio_KNHDEIMMFQ\" value=\"\"></input> <span>Irrelevant variables make the model imposible to estimate</span></label></div>\n\n\nVariable selection involves arbitrating this bias-variance trade-off.\n\n### Information Criteria\n\nTo select which variables to include and not to include, a basic and usual approach is to use Information Criteria. We will choose the model that minimizes an information criterion, either the Akaike Information Criterion (AIC) or the Bayesian Information Criterion (BIC). The associated functions are `AIC` and `BIC`.\n\nWrite several models including some of the following variables, in addition of `educ`: `exper`, `expersq`, `married`, `tenure`, `female`, `numdep` and `nonwhite`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nreg_1 <- lm(...)\nreg_2 <- lm(...)\nreg_3 <- lm(...)\nreg_4 <- lm(...)\n\nAIC(reg_1, reg_2, reg_3, reg_4)\n\nBIC(reg_1, reg_2, reg_3, reg_4)\n```\n:::\n\n\nWhich model would you choose?\n\nIn particular, estimate the model including all the covariates, compute its AIC. Then do the same thing but excluding `nonwhite`. Which model would you choose?^[Here the line between the two is pretty fine and the difference not particularly stark.]\n\n\n\n\n",
    "supporting": [
      "ex_3_selection_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}