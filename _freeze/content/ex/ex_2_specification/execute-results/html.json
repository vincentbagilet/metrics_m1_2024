{
  "hash": "dbc1f43c6e7a902e1b47d39194718908",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Exercise - Specification\"\nsubtitle: \"Why use particular functional transformations for the variables in your model?\"\npublished-title: \"Date\"\ndate: \"2024-10-08\"\nself-contained: true\nengine: knitr\n---\n\n::: {.cell}\n\n:::\n\n\n::: {.callout-important title=\"Instructions\"}\nThis page gives both instructions and some interactive snippets. You will have to run most of your code on `RStudio`, on your own computer.\n:::\n\nFirst, let's load useful packages. We need the `tidyverse` package but also to install the `gapminder` package (it contains the dataset we are interested in).\n\n\n::: {.cell}\n\n```{.r .cell-code  code-fold=\"true\"}\n# install.packages(\"gapminder\")\n\nlibrary(tidyverse)\nlibrary(gapminder)\n```\n:::\n\n\n## Exploring the data set\n\n### The data\n\nLoad the data by calling `gapminder` (after loading the package using `library(gapminder)`). \n\nWhat does each variable represent? (use the `help()` function). How many countries are there in this data set? <input class='webex-solveme nospaces' size='3' data-answer='[\"142\"]'/>. \n\n### \"Research\" question\n\n::: {.callout-important title=\"Objective\"}\nHere, we will study the relationship between `lifeExp` and `gdpPercap`.\n:::\n\nThe goal is to study the relationship between GDP per capita and life expectancy at birth. We can ask questions like: do \"richer\" countries have a larger life expectancy on average? On average, how different is life expectancy between two countries that have a 1 billion difference in GDP per capita?\n\nThink about other interesting questions you could answer with this data set (start simple). \n\n### Plot\n\nPlot a scatter plot of `lifeExp` as a function of `gdpPercap`. To do so, use the [same lines of code as in the previous exercise on airquality](ex_1_linear_regression.qmd), changing the relevant variables names. \n\n\n::: {.cell}\n\n```{.r .cell-code}\n#plot\n```\n:::\n\n\nInterpret this graph. For which level of GDP/capita is the difference between two countries having relatively similar GDP per capita the largest?\n\nDoes the relationship described on the graph you plotted look linear? <select class='webex-select'><option value='blank'></option><option value=''>Yes, roughly</option><option value='answer'>Not at all</option></select>\n\nWhat if you plot the log of `gdpPercap`, replacing `gdpPercap` by `log(gdpPercap)`? <select class='webex-select'><option value='blank'></option><option value='answer'>Yes, roughly</option><option value=''>Not at all</option></select>. \n\nWhy does the log allow to have a more linear relationship here? Plot the distribution of the `gdpPercap`, using the following lines of code, filling in the blanks. Which variable should you put on the x-axis? <input class='webex-solveme nospaces' size='9' data-answer='[\"gdpPercap\"]'/>\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = ..., aes(x = ...)) +\n  geom_histogram()\n```\n:::\n\n\nWhat do you notice about this distribution? Is it surprising to you? \n\nIf instead you plot the distribution of `log(gdpPercap)` (using the previous lines of code), this distribution seems roughly <input class='webex-solveme nospaces ignorecase' size='6' data-answer='[\"normal\"]'/>. Importantly, it is relatively centered around its mean. \n\n## Model and estimation\n\n### Model\n\nAssume you want to write a model to estimate the relationship between `gdpPercap` and `lifeExp` (or transformed versions of these variables) with OLS. For the resulting model to accurately represent the data generating process, the relationship between the variables therefore has to be linear. You want to write a model of the form\n\n$$y = \\alpha + \\beta x + e$$\nWhat should be $y$ in your case? <input class='webex-solveme nospaces' size='7' data-answer='[\"lifeExp\"]'/>. And x? <input class='webex-solveme nospaces' size='14' data-answer='[\"log(gdpPercap)\"]'/>.\n\n### Regression\n\nTo estimate this model, we will use the `lm` function. Which formula should you pass to the function? <input class='webex-solveme nospaces' size='24' data-answer='[\"lifeExp ~ log(gdpPercap)\"]'/>. Run the estimtion and display the output using the `summary()` function.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nreg <- lm(data = ..., formula = ...)\n\n\nsummary(...)\n```\n:::\n\n\n::: callout-note\nBefore doing the next questions, please read the slides, including the few that we did not have time to cover in class, they will help you answer the questions.\n:::\n\nWhat is the point estimate for `lifeExp`? <input class='webex-solveme nospaces' data-tol='0.1' size='3' data-answer='[\"8.4\"]'/>. How would you interpret this coefficient? \n\n\n::: {.cell}\n\n:::\n\n\n<div class='webex-radiogroup' id='radio_MCVVAROCKA'><label><input type=\"radio\" autocomplete=\"off\" name=\"radio_MCVVAROCKA\" value=\"\"></input> <span>Comparing two countries, we expect a country in which the GDP per capita is $1 larger than in the other to have a life expectancy that is on average 8.4 years larger</span></label><label><input type=\"radio\" autocomplete=\"off\" name=\"radio_MCVVAROCKA\" value=\"\"></input> <span>Comparing two countries, we expect a country in which the GDP per capita is 1% larger than in the other to have a life expectancy that is on average 8.4 years larger</span></label><label><input type=\"radio\" autocomplete=\"off\" name=\"radio_MCVVAROCKA\" value=\"\"></input> <span>Comparing two countries, we expect a country in which the GDP per capita is $1 larger than in the other to have a life expectancy that is on average 8.4% larger</span></label><label><input type=\"radio\" autocomplete=\"off\" name=\"radio_MCVVAROCKA\" value=\"answer\"></input> <span>Comparing two countries, we expect a country in which the GDP per capita is 1% larger than in the other to have a life expectancy that is on average 0.084 years larger</span></label><label><input type=\"radio\" autocomplete=\"off\" name=\"radio_MCVVAROCKA\" value=\"\"></input> <span>Comparing two countries, we expect a country in which the GDP per capita is 1% larger than in the other to have a life expectancy that is on average 8.4%  larger</span></label><label><input type=\"radio\" autocomplete=\"off\" name=\"radio_MCVVAROCKA\" value=\"\"></input> <span>Comparing two countries, we expect a country in which the GDP per capita is 1% larger than in the other to have a life expectancy that is on average 0.084% larger</span></label></div>\n\n\nIs this number exact or is it an approximation? <select class='webex-select'><option value='blank'></option><option value=''>Exact</option><option value='answer'>Approximation</option></select>\n\nDoes this number seem reasonable to you? Think about what it entails.\n\n### Heteroskedasticity\n\nLet's now look at the residuals of this regression in order to explore potential risks of heteroskedasticity. We can retrieve the residuals of a regression with the function `resid <- residuals(reg)` or by extracting them from the output of the regression: `resid <- reg$residuals`. Try these two approaches and look at the resulting vecotrs.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nresid <- residuals(reg)\nresid <- reg$residuals\n```\n:::\n\n\nRemember what heteroskedasticity is. Which scatter plot should we plot to observe it, if there is any to observe? <input class='webex-solveme nospaces' size='5' data-answer='[\"resid\"]'/> against <input class='webex-solveme nospaces' size='14' data-answer='[\"log(gdpPercap)\",\"x\",\"X\"]'/>. \n\nTo do that, we should store these variable into a dataframe, using the tibble function. Let's call them `x1` and `x2` for the sake of the example. Replace `x1` and `x2` by the relevant variables in the following code. Note that to access variables in the `gapminder` dataset, you need to use `$`: for instance to access the variable year, write `gapminder$year`.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata_residuals <- tibble(name_x1 = x1, name_x2 = x2)\n  \nggplot(data = data_residuals, aes(x = .., y = ..)) + \n  geom_point() + \n  geom_smooth()\n```\n:::\n\n\nDoes there seem to be some heteroskedasticity here? <select class='webex-select'><option value='blank'></option><option value='answer'>Yes</option><option value=''>No</option></select>\n\nWhy is it problematic? \n\nThere are actually formal tests for heteroskedasticity. They however go beyond what is covered in this section of the class.\n\n### Distribution of the residuals\n\nWe saw in class that when the residuals are normally distributed, our estimator has nice properties. Plot an histogram to describe the distribution of the residuals. Which function should you use? <input class='webex-solveme nospaces' size='14' data-answer='[\"geom_histogram\"]'/>\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(data = data_residuals, aes(x = .., y = ..)) + \n  ...\n```\n:::\n\n\nDoes that seem roughly normally distributed? <select class='webex-select'><option value='blank'></option><option value='answer'>Yes</option><option value=''>No</option></select>\n\nTo actually test for normality, there is a bunch of tests one can implement but you will learn more about these later. For example, we can plot the residuals against draws from a normal distribution. If the residuals are normally distributed, the resulting points will be on the identity line. To plot this, we can use the `geom_qq()` function (`geom_qq_line()` plots the identity line):\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata_residuals |> \n  ggplot(aes(sample = resid)) + \n  geom_qq() + \n  geom_qq_line()\n```\n:::\n",
    "supporting": [
      "ex_2_specification_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}